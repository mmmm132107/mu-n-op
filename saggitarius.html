<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>sagittarius</title>

<style>

body{
  margin:0;
  height:100vh;
  background:radial-gradient( circle at 40% 20%, #1a2b4a, #07101f 70% );
  color:#e8ecf6;
  font-family:serif;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

/* intro text */
#intro{
  font-size:20px;
  opacity:.9;
  letter-spacing:.5px;
  transition:.7s;
}
.hide{ opacity:0; pointer-events:none; }

/* board wrapper */
.board-wrap{
  display:none;
  flex-direction:column;
  align-items:center;
}

/* board itself */
.board{
  display:grid;
  grid-template-columns:repeat(8,72px);
  grid-template-rows:repeat(8,72px);
  border-radius:14px;
  overflow:hidden;
  border:2px solid rgba(160,200,255,.35);
  box-shadow:0 0 36px rgba(90,140,220,.35);
}

/* gradient squares */
.light{
  background:linear-gradient(145deg,#f4f7ff,#cfd8ff);
}
.dark{
  background:linear-gradient(145deg,#6f82b7,#40527f);
}

.cell{
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:36px;
  cursor:pointer;
  user-select:none;
}

.cell:hover{
  outline:2px solid rgba(220,240,255,.6);
}

/* message banners */
#status{
  margin-top:16px;
  font-style:italic;
  opacity:0;
  transition:.7s;
}
#status.show{ opacity:1; }

.success{ color:#9fffae; }
.fail{ color:#ff9090; }

</style>
</head>

<body>

<div id="intro">play the plot — play the horse</div>

<div class="board-wrap" id="wrap">
  <div class="board" id="board"></div>
  <div id="status"></div>
</div>

<script>

/*
   TOẠ ĐỘ

   row 0 → rank 8
   row 7 → rank 1
   col 0 → a
   col 7 → h

   TRẠNG THÁI BAN ĐẦU

   ♚ b8 = (0,1)
   ♔ b6 = (2,1)
   ♗ e6 = (2,4)
   ♞ c5 = (3,2)

   YÊU CẦU

   Người chơi đi đúng:
     c5 → a6  (3,2 → 2,0)

   Sau đó máy tự đi:
     ♚ b8 → a8
     ♗ e6 → d5

   Sai nước → thất bại → quay về veil.html
*/

const board = document.getElementById("board");
const intro = document.getElementById("intro");
const wrap = document.getElementById("wrap");
const statusBox = document.getElementById("status");

/* positions */
let knight = { r:3, c:2 };
let kingBlack = { r:0, c:1 };
let kingWhite = { r:2, c:1 };
let bishop    = { r:2, c:4 };

const STEP1 = { r:2, c:0 }; // a6 (nước hợp lệ duy nhất)

let progressed = false;

/* show board after intro fades */
setTimeout(()=>{
  intro.classList.add("hide");
  setTimeout(()=>{
    wrap.style.display="flex";
    draw();
  },600);
},1100);

/* render board */
function draw(){
  board.innerHTML="";

  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){

      const cell=document.createElement("div");
      cell.className="cell "+((r+c)%2===0?"light":"dark");

      if(r===kingBlack.r && c===kingBlack.c) cell.textContent="♚";
      if(r===kingWhite.r && c===kingWhite.c) cell.textContent="♔";
      if(r===bishop.r    && c===bishop.c)    cell.textContent="♗";
      if(r===knight.r    && c===knight.c)    cell.textContent="♞";

      cell.onclick=()=>attempt(r,c);
      board.appendChild(cell);
    }
  }
}

/* knight move rule */
function isKnightMove(r,c){
  const dr=Math.abs(r-knight.r);
  const dc=Math.abs(c-knight.c);
  return (dr===2 && dc===1) || (dr===1 && dc===2);
}

/* reset + failure */
function fail(){
  statusBox.textContent="mission failed.";
  statusBox.className="fail show";
  setTimeout(()=> window.location.href="veil.html", 1200);
}

/* success sequence */
function succeed(){
  statusBox.textContent="The king is captured.";
  statusBox.className="success show";

  setTimeout(()=> window.location.href="memory.html", 1200);
}

/* handle move */
function attempt(r,c){

  if(!isKnightMove(r,c)) return fail();

  // chỉ chấp nhận nước c5 → a6
  if(!progressed){

    if(r===STEP1.r && c===STEP1.c){

      knight={r,c};
      progressed=true;
      draw();

      // máy tự diễn biến
      setTimeout(()=>{
        kingBlack={ r:0, c:0 }; // b8 → a8
        draw();

        setTimeout(()=>{
          bishop={ r:3, c:3 }; // e6 → d5
          draw();
          succeed();
        },600);

      },600);

    } else return fail();
  }
}

</script>

</body>
</html>
