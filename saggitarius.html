<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>sagittarius</title>

<style>
body{
  margin:0;
  height:100vh;
  background:radial-gradient(circle at 40% 20%, #13223a, #050910 70%);
  color:#e8ecf6;
  font-family:serif;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

#intro{
  font-size:20px;
  opacity:.95;
  transition:.7s;
}
.hide{ opacity:0; pointer-events:none; }

.board-wrap{
  display:none;
  flex-direction:column;
  align-items:center;
  gap:10px;
}

/* b·∫£ng 8√ó8 */
.board{
  position:relative;
  display:grid;
  grid-template-columns:repeat(8,72px);
  grid-template-rows:repeat(8,72px);
  border-radius:14px;
  overflow:hidden;
  border:2px solid rgba(160,200,255,.35);
  box-shadow:0 0 34px rgba(100,150,230,.35);
  background:linear-gradient(145deg,#3c4f79,#1d2945);
}

/* √¥ */
.light{ background:#eef1ff; }
.dark { background:#8fa1c8; }

.cell{
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:38px;
  cursor:pointer;
  user-select:none;
}

/* th√¥ng b√°o */
#status{
  margin-top:6px;
  opacity:0;
  transition:.7s;
}
#status.show{ opacity:1; }
.success{ color:#a9ffbf; }
.fail{ color:#ff8f8f; }

/* canvas hi·ªáu ·ª©ng tan */
#dust{
  position:absolute;
  inset:0;
  pointer-events:none;
}
</style>
</head>

<body>

<div id="intro">play the plot ‚Äî play the horse</div>

<div class="board-wrap" id="wrap">
  <div class="board" id="board">
    <canvas id="dust"></canvas>
  </div>
  <div id="status"></div>
</div>

<script>
/*
 B·ªê C·ª§C BAN ƒê·∫¶U
 ‚ôö b8
 ‚ôî b6
 ‚ôó e6
 ‚ôû c5

 Ng∆∞·ªùi ch∆°i b·∫Øt bu·ªôc:
   c5 ‚Üí a6

 M√°y t·ª± ƒëi:
   ‚ôö b8 ‚Üí a8
   ‚ôó e6 ‚Üí d5

 Sau ƒë√≥:
   ‚ÄúThe king is captured‚Äù
   ‚Üí b√†n c·ªù tan th√†nh c√°t b·ª•i
   ‚Üí sang memory.html
*/

const intro = document.getElementById("intro");
const wrap  = document.getElementById("wrap");
const board = document.getElementById("board");
const statusBox = document.getElementById("status");
const dust = document.getElementById("dust");
const ctx = dust.getContext("2d");

/* v·ªã tr√≠ qu√¢n */
let knight = {r:3,c:2};
let kingB  = {r:0,c:1};
let kingW  = {r:2,c:1};
let bishop = {r:2,c:4};

const STEP1 = {r:2,c:0}; // a6
let progressed = false;

/* intro ‚Üí hi·ªán b√†n */
setTimeout(()=>{
  intro.classList.add("hide");
  setTimeout(()=>{
    wrap.style.display="flex";
    draw();
    resizeDust();
  },600);
},900);

window.addEventListener("resize", resizeDust);

function resizeDust(){
  dust.width = board.clientWidth;
  dust.height = board.clientHeight;
}

/* v·∫Ω b√†n */
function draw(){
  board.querySelectorAll(".cell").forEach(n=>n.remove());

  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){

      const d=document.createElement("div");
      d.className="cell "+((r+c)%2===0?"light":"dark");

      if(r===kingB.r && c===kingB.c) d.textContent="‚ôö";
      if(r===kingW.r && c===kingW.c) d.textContent="‚ôî";
      if(r===bishop.r && c===bishop.c) d.textContent="‚ôó";
      if(r===knight.r && c===knight.c) d.textContent="‚ôû";

      d.onclick=()=>attempt(r,c);
      board.appendChild(d);
    }
  }
}

/* n∆∞·ªõc ƒëi h·ª£p l·ªá c·ªßa m√£ */
function isKnightMove(r,c){
  const dr=Math.abs(r-knight.r);
  const dc=Math.abs(c-knight.c);
  return (dr===2&&dc===1)||(dr===1&&dc===2);
}

/* th·∫•t b·∫°i */
function fail(){
  statusBox.textContent="mission failed";
  statusBox.className="fail show";
  setTimeout(()=>location.href="veil.html",1100);
}

/* ho√†n th√†nh */
function succeed(){
  statusBox.textContent="The king is captured";
  statusBox.className="success show";

  setTimeout(()=>dustToSand(),400);
}

/* x·ª≠ l√Ω n∆∞·ªõc ƒëi */
function attempt(r,c){

  if(!isKnightMove(r,c)) return fail();

  if(!progressed){

    if(r===STEP1.r && c===STEP1.c){

      knight={r,c};
      progressed=true;
      draw();

      // m√°y t·ª± di·ªÖn di·ªÖn bi·∫øn
      setTimeout(()=>{
        kingB={r:0,c:0};
        draw();

        setTimeout(()=>{
          bishop={r:3,c:3};
          draw();
          succeed();
        },600);

      },600);

    } else return fail();
  }
}

/* ========= üå´Ô∏è hi·ªáu ·ª©ng c√°t b·ª•i ========= */

function dustToSand(){
  const cells=[...document.querySelectorAll(".cell")];

  const particles=[];

  cells.forEach(cell=>{
    const rect = cell.getBoundingClientRect();
    const br = board.getBoundingClientRect();

    const x0 = rect.left - br.left;
    const y0 = rect.top  - br.top;

    for(let i=0;i<24;i++){
      particles.push({
        x:x0+Math.random()*rect.width,
        y:y0+Math.random()*rect.height,
        vx:(Math.random()-.5)*1.4,
        vy:-Math.random()*1.6,
        life:1
      });
    }
  });

  let t=0;

  function anim(){
    ctx.clearRect(0,0,dust.width,dust.height);

    particles.forEach(p=>{
      p.x+=p.vx;
      p.y+=p.vy;
      p.vy+=0.02;
      p.life-=0.01;

      ctx.fillStyle=`rgba(210,225,255,${p.life})`;
      ctx.fillRect(p.x,p.y,2,2);
    });

    t++;

    if(t<120) requestAnimationFrame(anim);
    else location.href="memory.html";
  }

  anim();
}
</script>

</body>
</html>
