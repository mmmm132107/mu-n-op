<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>sagittarius</title>

<style>
body{
  margin:0;
  height:100vh;
  background:radial-gradient(circle at 40% 20%, #0e1830, #02050b 70%);
  color:#e8ecff;
  font-family:serif;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

/* intro text */
#intro{
  font-size:20px;
  opacity:.95;
  letter-spacing:.05em;
  transition:.7s;
}
.hide{ opacity:0; pointer-events:none; }

/* space stage */
.stage{
  display:none;
  position:relative;
  width:560px;
  height:560px;
  border-radius:18px;
  box-shadow:0 0 60px rgba(120,160,255,.25);
  background:
    radial-gradient(circle at 30% 25%, rgba(120,150,255,.18), transparent 40%),
    radial-gradient(circle at 70% 70%, rgba(80,120,255,.12), transparent 45%),
    #0c1426;
  overflow:hidden;
}

/* faint star field */
.star{
  position:absolute;
  width:3px;
  height:3px;
  border-radius:50%;
  background:#d8e6ff;
  opacity:.6;
}
.star:nth-child(odd){
  animation: drift 6s ease-in-out infinite;
}
@keyframes drift{
  0%{ transform:translateY(0); }
  50%{ transform:translateY(-6px); }
  100%{ transform:translateY(0); }
}

/* chess pieces — glowing */
.piece{
  position:absolute;
  font-size:42px;
  color:#ffffff;
  text-shadow:
    0 0 10px rgba(200,230,255,.9),
    0 0 20px rgba(160,200,255,.7);
  cursor:pointer;
  user-select:none;
}

/* king black darker */
.black{
  color:#d0d4e0;
  text-shadow:0 0 10px rgba(120,140,180,.7);
}

/* status text */
#status{
  margin-top:12px;
  opacity:0;
  transition:.7s;
}
#status.show{ opacity:1; }
.success{ color:#a9ffbf; }
.fail{ color:#ff8f8f; }

/* dust canvas */
#dust{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
}
</style>
</head>

<body>

<div id="intro">play the plot — play the horse</div>

<div class="stage" id="stage">
  <canvas id="dust"></canvas>

  <!-- small background stars -->
  <div class="star" style="top:12%;left:22%"></div>
  <div class="star" style="top:26%;left:74%"></div>
  <div class="star" style="top:48%;left:18%"></div>
  <div class="star" style="top:68%;left:42%"></div>
  <div class="star" style="top:72%;left:66%"></div>
  <div class="star" style="top:34%;left:82%"></div>

  <!-- pieces (absolute positions instead of chess grid) -->

  <!-- ♚ b8 -->
  <div id="bk" class="piece black" style="top:40px; left:120px">♚</div>

  <!-- ♔ b6 -->
  <div id="wk" class="piece" style="top:200px; left:120px">♔</div>

  <!-- ♗ e6 -->
  <div id="wb" class="piece" style="top:200px; left:360px">♗</div>

  <!-- ♞ c5 (player piece) -->
  <div id="wn" class="piece" style="top:280px; left:220px">♞</div>

</div>

<div id="status"></div>

<script>
const intro  = document.getElementById("intro");
const stage  = document.getElementById("stage");
const statusBox = document.getElementById("status");

const bk = document.getElementById("bk");
const wk = document.getElementById("wk");
const wb = document.getElementById("wb");
const wn = document.getElementById("wn");

const dust = document.getElementById("dust");
const ctx = dust.getContext("2d");

let progressed = false;

/* ===== intro → show stage ===== */
setTimeout(()=>{
  intro.classList.add("hide");
  setTimeout(()=>{
    stage.style.display="block";
    resizeDust();
  },600);
},900);

window.addEventListener("resize", resizeDust);
function resizeDust(){
  dust.width  = stage.clientWidth;
  dust.height = stage.clientHeight;
}

/* ===== helper: animate piece movement ===== */
function move(el, x, y, cb){
  el.style.transition="0.6s";
  el.style.left = x+"px";
  el.style.top  = y+"px";
  setTimeout(()=> cb && cb(), 650);
}

/* ===== FAIL ===== */
function fail(){
  statusBox.textContent="mission failed";
  statusBox.className="fail show";
  setTimeout(()=>location.href="veil.html",1200);
}

/* ===== SUCCESS ===== */
function succeed(){
  statusBox.textContent="The king is captured";
  statusBox.className="success show";
  setTimeout(()=>dustToSand(),500);
}

/* ===== CLICK KNIGHT (player move) ===== */
wn.onclick = ()=>{

  if(progressed) return;

  // required move: c5 → a6
  // we simulate it by moving to left‑top position
  move(wn, 40, 200, ()=>{

    progressed = true;

    // black king → a8
    setTimeout(()=>{
      move(bk, 40, 40, ()=>{

        // bishop → d5
        setTimeout(()=>{
          move(wb, 300, 280, ()=>{
            succeed();
          });
        },450);

      });
    },450);

  });
};

/* ====== sand dissolve ====== */
function dustToSand(){

  const pcs = [bk,wk,wb,wn];
  const particles=[];

  pcs.forEach(el=>{
    const r = el.getBoundingClientRect();
    const s = stage.getBoundingClientRect();

    const x0 = r.left - s.left;
    const y0 = r.top  - s.top;

    for(let i=0;i<40;i++){
      particles.push({
        x:x0+Math.random()*r.width,
        y:y0+Math.random()*r.height,
        vx:(Math.random()-.5)*1.6,
        vy:-Math.random()*1.8,
        life:1
      });
    }

    el.style.opacity=0;
  });

  let t=0;

  (function anim(){
    ctx.clearRect(0,0,dust.width,dust.height);

    particles.forEach(p=>{
      p.x+=p.vx;
      p.y+=p.vy;
      p.vy+=0.02;
      p.life-=0.01;

      ctx.fillStyle=`rgba(210,225,255,${p.life})`;
      ctx.fillRect(p.x,p.y,2,2);
    });

    t++;
    if(t<140) requestAnimationFrame(anim);
    else location.href="memory.html";
  })();
}
</script>

</body>
</html>
